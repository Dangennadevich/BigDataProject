## ДЗ - 2

1. (team:jn) Настраиваем конфиг для nginx -  копируем базовые настройкм

```sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/nn```

2. (team:jn) Меняем базовую конфигурацию для nn (Порт который слушаем и 
порт 
куда транслируем)

```
server {
        listen 9870 default_server;
        # listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                # try_files $uri $uri/ =404;
                proxy_pass http://192.168.1.75:9870;
        }

        # pass PHP scripts to FastCGI server
        #
        #location ~ \.php$ {
        #       include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
        #       fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #       deny all;
        #}

}
``` 

3. (team:jn) Включаем nginx для nn, перезапускаем nginx. Nginx Должен 
стать доступным локально по адресу jump node: http://176.109.91.20:9870/  

```sudo ln -s /etc/nginx/sites-available/nn /etc/nginx/sites-enabled/nn```

```sudo systemctl reload nginx```


4. (hadoop:nn) Настраиваем конфиг mapreduce 


```
nano hadoop-3.4.0/etc/hadoop/mapred-site.xml
``` 

Вносим в файл:

``` 
<configuration>
        <property>
                <name>mapreduce.framework.name</name>
                <value>yarn</value>
        </property>
        <property>
                <name>mapreduce.application.classpath</name>
                <value>$HADOOP_HOME/share/hadoop/mapreduce/*:$HADOOP_HOME/share/hadoop/mapreduce/lib/*</value>
        </property>
</configuration>
```

5. (hadoop:nn) настраиваем конфиг Yarn

```
nano hadoop-3.4.0/etc/hadoop/yarn-site.xml
```

Вносим в файл:
   
```
<configuration>

<!-- Site specific YARN configuration properties -->

        <property>
                <name>yarn.nodemanager.aux-services</name>
                <value>mapreduce_shuffle</value>
        </property>
        <property>
                <name>yarn.nodemanager.env-whitelist</name>
                <value>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_HOME,PATH,LANG,TZ,HADOOP_MAPRED_HOME</value>
        </property>
</configuration>
```

6. (hadoop:nn) Скопируем конфиги на dn-00 dn-01

```
scp hadoop-3.4.0/etc/hadoop/mapred-site.xml hadoop@192.168.1.76:/home/hadoop/hadoop-3.4.0/etc/hadoop/mapred-site.xml && \
scp hadoop-3.4.0/etc/hadoop/mapred-site.xml hadoop@192.168.1.77:/home/hadoop/hadoop-3.4.0/etc/hadoop/mapred-site.xml && \
scp hadoop-3.4.0/etc/hadoop/yarn-site.xml hadoop@192.168.1.76:/home/hadoop/hadoop-3.4.0/etc/hadoop/yarn-site.xml && \
scp hadoop-3.4.0/etc/hadoop/yarn-site.xml hadoop@192.168.1.77:/home/hadoop/hadoop-3.4.0/etc/hadoop/yarn-site.xml
```

7. (hadoop:nn) Запускаем YARN

```
hadoop-3.4.0/sbin/start-yarn.sh
```

8. (hadoop:nn) Запускаем history server

```
mapred --daemon start historyserver
```

9. (team:jn) Настраиваем nginx - создаем конфигурационные файлы yarn и history server

```
sudo cp /etc/nginx/sites-available/nn /etc/nginx/sites-available/ya

sudo cp /etc/nginx/sites-available/nn /etc/nginx/sites-available/dh
```

10. (team:jn) Редактируем конфиг для nginx (yarn)

```
sudo nano  /etc/nginx/sites-available/ya
```

```
server {
        listen 8088 default_server;
        # listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                # try_files $uri $uri/ =404;
                proxy_pass http://192.168.1.75:8088;
        }

        # pass PHP scripts to FastCGI server
        #
        #location ~ \.php$ {
        #       include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
        #       fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #       deny all;
        #}
}
```

11. (team:jn) Редактируем конфиг для nginx (history server)

```
sudo nano  /etc/nginx/sites-available/dh
```
   
```
server {
        listen 19888 default_server;
        # listen [::]:80 default_server;
        
        # SSL configuration
        # 
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        # 
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        # 
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        # 
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        # 
        # include snippets/snakeoil.conf;
        
        root /var/www/html;
        
        # Add index.php to the list if you are using PHP   
        index index.html index.htm index.nginx-debian.html;
        
        server_name _;

	location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                # try_files $uri $uri/ =404;
                proxy_pass http://192.168.1.75:19888;
        }

        # pass PHP scripts to FastCGI server
        #
        #location ~ \.php$ {
        #       include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
        #       fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #       deny all;
        #}
}

12. (team:jn) Включаем хосты

```
sudo ln -s /etc/nginx/sites-available/ya /etc/nginx/sites-enabled/ya

sudo ln -s /etc/nginx/sites-available/dh /etc/nginx/sites-enabled/dh
```

13. Перезапускаем nginx

``` 
sudo systemctl reload nginx
``` 

14. Проверяем доступность Yarn и history server

```
http://176.109.91.20:19888/

http://176.109.91.20:8088/
```

15. (hadoop:nn) Останавливаем сервисы (hostory server, Yarn, распределенную файловую систему)

``` 
cd hadoop-3.4.0

mapred --daemon stop historyserver

sbin/stop-yarn.sh

sbin/stop-dfs.sh
``` 
